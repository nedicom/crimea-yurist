{% load review_tags %}

<!-- JSON-LD разметка для отзывов -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "Юридические услуги",
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "reviewCount": "{{ reviews|length }}"
    },
    "review": [
      {% get_reviews as reviews %}
      {% for review in reviews %}
      {
        "@type": "Review",
        "author": {
          "@type": "Person",
          "name": "{{ review.client_name }}"
        },
        "reviewRating": {
          "@type": "Rating",
          "ratingValue": "{{ review.rating }}",
          "bestRating": "5"
        },
        "reviewBody": "{{ review.review_text|striptags|truncatewords:30|escapejs }}"
        {% if review.case_type_review %},
        "about": "{{ review.case_type_review }}"
        {% endif %}
      }{% if not forloop.last %},{% endif %}
      {% endfor %}
    ]
  }
</script>

<div class="py-16 md:py-24 px-4 sm:px-6 lg:px-8 bg-gray-50">
  <div class="max-w-7xl mx-auto">
    <!-- Заголовок блока -->
    <div class="text-center max-w-3xl mx-auto mb-16">
      <div
        class="inline-flex items-center gap-2 bg-blue-100 text-blue-800 px-4 py-2 rounded-full mb-4"
      >
        <i class="fas fa-star"></i>
        <span class="text-sm font-medium">Отзывы клиентов</span>
      </div>

      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
        Что еще говорят <span class="text-blue-600">наши клиенты</span>
      </h2>

      <p class="text-xl text-gray-600">
        Клиенты, которые доверили нам решение своих юридических вопросов
      </p>
    </div>

    <!-- Контейнер с горизонтальной прокруткой -->
    <div class="reviews-scroll-container">
      <div class="reviews-scroll-content">
        {% load review_tags %}
        <div class="reviews-scroll-content">
          {% get_reviews as reviews %} {% for review in reviews %}
          <div class="reviews-scroll-item">
            <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 h-full">
              <!-- Аватар -->
              <div class="flex items-center gap-4 mb-6">
                <div>
                  <div class="text-lg md:text-xl font-bold text-gray-900">
                    {{ review.client_name }}
                  </div>
                  {% if review.case_type_review %}
                  <p class="text-gray-600 text-sm md:text-base">
                    {{ review.case_type_review }}
                  </p>
                  {% endif %}
                </div>

                <!-- Звезды рейтинга -->
                <div class="flex items-center gap-1 mb-4">
                  {% for i in "12345" %} {% if forloop.counter <= review.rating %}
                  <span class="text-yellow-400 text-sm md:text-base">⭐</span>
                  {% else %}
                  <span class="text-gray-300 text-sm md:text-base">⭐</span>
                  {% endif %} {% endfor %}
                </div>
              </div>

              <!-- Текст отзыва -->
              <p
                class="text-gray-700 text-base md:text-lg leading-relaxed mb-6"
              >
                "{{ review.review_text|striptags|truncatewords:30 }}"
              </p>
            </div>
          </div>
          {% empty %}
          <div class="reviews-scroll-item">
            <div
              class="bg-white rounded-2xl shadow-lg p-6 md:p-8 h-full text-center"
            >
              <p class="text-gray-500">Пока нет отзывов</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Подсказка для пользователя -->
    <div class="mt-8 text-center">
      <div class="inline-flex items-center gap-2 text-gray-500 text-sm">
        <i class="fas fa-arrows-left-right"></i>
        <span>Перетащите в сторону чтобы увидеть больше отзывов</span>
      </div>
    </div>
  </div>
</div>

<style>
  .reviews-scroll-container {
    cursor: grab;
  }

  .reviews-scroll-container:active {
    cursor: grabbing;
  }

  .reviews-scroll-container {
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    /* Плавный скролл на iOS */
    scrollbar-width: thin;
    /* Тонкий скроллбар для Firefox */
    scrollbar-color: #cbd5e0 #f7fafc;
    /* Цвет скроллбара для Firefox */
    cursor: grab;
  }

  .reviews-scroll-container:active {
    cursor: grabbing;
  }

  /* Стилизация скроллбара для Webkit браузеров */
  .reviews-scroll-container::-webkit-scrollbar {
    height: 8px;
  }

  .reviews-scroll-container::-webkit-scrollbar-track {
    background: #f7fafc;
    border-radius: 4px;
  }

  .reviews-scroll-container::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 4px;
  }

  .reviews-scroll-container::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
  }

  .reviews-scroll-content {
    display: flex;
    gap: 2rem;
    padding: 1rem 0.5rem;
    width: max-content;
  }

  .reviews-scroll-item {
    flex: 0 0 auto;
    width: 350px;
    /* Фиксированная ширина карточки */
  }

  /* Адаптивность для мобильных */
  @media (max-width: 640px) {
    .reviews-scroll-item {
      width: 300px;
      /* Уже карточки на мобильных */
    }

    .reviews-scroll-content {
      gap: 1rem;
      padding: 0.5rem 0.25rem;
    }
  }

  /* Плавная анимация при скролле */
  .reviews-scroll-container {
    scroll-behavior: smooth;
  }

  /* Убираем выделение текста при перетаскивании */
  .reviews-scroll-container {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  /* Ховер-эффекты для карточек */
  .reviews-scroll-item {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .reviews-scroll-item:hover {
    transform: translateY(-2px);
  }

  .reviews-scroll-item .bg-white {
    transition: box-shadow 0.2s ease;
  }

  .reviews-scroll-item:hover .bg-white {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
      0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const container = document.querySelector(".reviews-scroll-container");
    let isDragging = false;
    let startX;
    let scrollLeft;

    container.addEventListener("mousedown", (e) => {
      isDragging = true;
      container.style.cursor = "grabbing";
      startX = e.pageX - container.offsetLeft;
      scrollLeft = container.scrollLeft;
    });

    container.addEventListener("mouseleave", () => {
      isDragging = false;
      container.style.cursor = "grab";
    });

    container.addEventListener("mouseup", () => {
      isDragging = false;
      container.style.cursor = "grab";
    });

    container.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      e.preventDefault();
      const x = e.pageX - container.offsetLeft;
      const walk = (x - startX) * 2; // множитель для скорости
      container.scrollLeft = scrollLeft - walk;
    });
  });
</script>
